<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fullscreen Video Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        #videoContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .controls-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.85), transparent);
            padding: 15px 20px;
            z-index: 2;
            transition: opacity 0.3s ease;
        }

        .controls-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
            padding: 8px;
        }

        button:hover {
            transform: scale(1.2);
            color: #ff3366;
        }

        button:disabled {
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            margin: 10px 0;
            cursor: pointer;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #ff3366, #ff5588);
            border-radius: 3px;
            width: 0;
            transition: width 0.1s;
        }

        .progress-container:hover .progress-bar {
            background: linear-gradient(to right, #ff5588, #ff7799);
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }

        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 8px 20px;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: opacity 0.3s;
        }

        .status-bar.hidden {
            opacity: 0;
        }

        .view-count {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .credit {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            z-index: 2;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            max-width: 200px;
        }

        .volume-button {
            font-size: 1.4rem;
            padding: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            transition: background 0.2s, transform 0.2s, color 0.2s;
        }

        .volume-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
            color: #ff3366;
        }

        .volume-slider {
            width: 100%;
            height: 6px;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.5));
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .volume-slider:hover {
            background: linear-gradient(to right, #ff3366, #ff5588);
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .server-container {
            position: relative;
            display: inline-block;
        }

        .server-button {
            font-size: 1.4rem;
            padding: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            transition: background 0.2s, transform 0.2s, color 0.2s;
        }

        .server-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
            color: #ff3366;
        }

        .server-dropdown {
            display: none;
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 3;
            min-width: 150px;
        }

        .server-dropdown.show {
            display: block;
        }

        .server-option {
            padding: 10px 15px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .server-option:hover {
            background: rgba(255, 51, 102, 0.7);
        }

        .error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 4;
            font-size: 1.2rem;
            background: rgba(255, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 4;
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .loading.hidden {
            display: none;
        }

        .loading i {
            animation: spin 1s linear infinite;
        }

        .rotate-prompt {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1rem;
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
            animation: slideIn 0.5s ease-out;
        }

        .rotate-prompt i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 6;
            background: linear-gradient(135deg, #ff3366, #ff5588);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            color: white;
            font-size: 1.1rem;
            max-width: 90%;
            animation: slideIn 0.5s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .notification a {
            color: #fff;
            text-decoration: underline;
            font-weight: bold;
        }

        .notification a:hover {
            color: #ffd700;
        }

        .notification button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification button:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: none;
        }

        @keyframes slideIn {
            from {
                transform: translate(-50%, -60%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .control-buttons {
                gap: 8px;
                flex-wrap: wrap;
            }

            button, .volume-button, .server-button {
                font-size: 1.1rem;
                padding: 5px;
            }

            .volume-control {
                max-width: 100px;
            }

            .server-dropdown {
                min-width: 100px;
                bottom: 35px;
            }

            .server-option {
                font-size: 0.7rem;
                padding: 6px 10px;
            }

            .notification {
                font-size: 0.9rem;
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="status-bar" id="statusBar">
        <span id="statusText">Video Player - Controls will hide automatically</span>
        <span class="view-count" id="viewCount">0 viewers</span>
    </div>

    <div id="videoContainer">
        <video id="videoPlayer" autoplay playsinline>
            Your browser does not support the video tag.
        </video>
    </div>

    <div class="controls-overlay" id="controlsOverlay">
        <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="control-buttons">
            <button id="skipBack" title="Skip Backward 10s"><i class="fas fa-backward"></i></button>
            <button id="playPause" title="Play/Pause"><i class="fas fa-play"></i></button>
            <button id="skipForward" title="Skip Forward 10s"><i class="fas fa-forward"></i></button>
            <button id="muteUnmute" class="volume-button" title="Mute/Unmute"><i class="fas fa-volume-up"></i></button>
            <button id="fullscreen" title="Toggle Fullscreen"><i class="fas fa-expand"></i></button>
            <div class="server-container">
                <button id="serverButton" class="server-button" title="Select Server"><i class="fas fa-server"></i></button>
                <div id="serverDropdown" class="server-dropdown">
                    <div class="server-option" data-url="https://plu2.myluck1.top:8088/live/webcricten1/playlist.m3u8?id=122866&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3">Sony Liv Hindi</div>
                    <div class="server-option" data-url="https://muc200.myluck1.top:8088/live/webcrichindi/playlist.m3u8?vidictid=20359496224&id=119771&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3">Willow server 2</div>
                    <div class="server-option" data-url="https://plu2.myluck1.top:8088/live/webcrichindi/playlist.m3u8?id=119771&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3">English Willow Live</div>
                    <div class="server-option" data-url="https://muc200.myluck1.top:8088/live/webcricn04/playlist.m3u8?id=114607&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3">Low Quality Hindi</div>
                </div>
            </div>
        </div>

        <div class="volume-control">
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.01" value="1">
        </div>
    </div>

    <div class="loading hidden" id="loadingIndicator">
        <i class="fas fa-spinner"></i> Loading video...
    </div>

    <div class="error-message" id="errorMessage">
        <i class="fas fa-exclamation-triangle"></i> <span id="errorText"></span>
    </div>

    <div class="rotate-prompt" id="rotatePrompt">
        <i class="fas fa-mobile-alt"></i>
        For best experience, rotate your device to landscape mode
    </div>

    <div class="notification" id="welcomeNotification">
        <span>Made by Shubham Kumar Jha</span>
        <a href="https://t.me/shubh97j" target="_blank">Contact on Telegram: t.me/shubh97j</a>
        <button id="closeNotification">Close</button>
    </div>

    <div class="credit">Made by Shubham</div>

    <script>
        // Configuration
        const VIDEO_SERVERS = [
            { url: "https://plu2.myluck1.top:8088/live/webcricten1/playlist.m3u8?id=122866&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3", name: "Sony Liv Hindi" },
            { url: "https://muc200.myluck1.top:8088/live/webcrichindi/playlist.m3u8?vidictid=20359496224&id=119771&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3", name: "Willow server 2" },
            { url: "https://plu2.myluck1.top:8088/live/webcrichindi/playlist.m3u8?id=119771&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3", name: "English Willow Live" },
            { url: "https://muc200.myluck1.top:8088/live/webcricn04/playlist.m3u8?id=114607&pk=d9fa12d7dda3ae43591bac95b2f10ef236acdadb170fb15914527ec94f8e64e1f66215971dd5df5c68e7369a19ff675d853c09058972aacd965b6d4e044fe6c3", name: "Low Quality Hindi" }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            const elements = {
                videoPlayer: document.getElementById('videoPlayer'),
                videoContainer: document.getElementById('videoContainer'),
                playPauseBtn: document.getElementById('playPause'),
                muteUnmuteBtn: document.getElementById('muteUnmute'),
                skipBackBtn: document.getElementById('skipBack'),
                skipForwardBtn: document.getElementById('skipForward'),
                fullscreenBtn: document.getElementById('fullscreen'),
                volumeSlider: document.getElementById('volumeSlider'),
                serverButton: document.getElementById('serverButton'),
                serverDropdown: document.getElementById('serverDropdown'),
                serverOptions: document.querySelectorAll('.server-option'),
                progressBar: document.getElementById('progressBar'),
                progressContainer: document.getElementById('progressContainer'),
                currentTimeDisplay: document.getElementById('currentTime'),
                durationDisplay: document.getElementById('duration'),
                controlsOverlay: document.getElementById('controlsOverlay'),
                statusBar: document.getElementById('statusBar'),
                statusText: document.getElementById('statusText'),
                loadingIndicator: document.getElementById('loadingIndicator'),
                errorMessage: document.getElementById('errorMessage'),
                errorText: document.getElementById('errorText'),
                rotatePrompt: document.getElementById('rotatePrompt'),
                viewCount: document.getElementById('viewCount'),
                welcomeNotification: document.getElementById('welcomeNotification'),
                closeNotification: document.getElementById('closeNotification')
            };

            let hls = null;
            let controlsTimeout;
            let isFullscreen = false;
            let retryCount = 0;
            const maxRetries = 3;
            let loadingTimeout;

            // Simulated WebSocket for view count
            function simulateViewCount() {
                let viewers = 100;
                setInterval(() => {
                    viewers += Math.floor(Math.random() * 10) - 5;
                    viewers = Math.max(0, viewers);
                    elements.viewCount.textContent = `${viewers} viewers`;
                }, 5000);
            }

            // Show error message
            function showError(message) {
                elements.errorMessage.style.display = 'flex';
                elements.errorText.textContent = message;
                elements.loadingIndicator.classList.add('hidden');
                clearTimeout(loadingTimeout);
                setTimeout(() => {
                    elements.errorMessage.style.display = 'none';
                }, 5000);
            }

            // Hide loading indicator
            function hideLoading() {
                clearTimeout(loadingTimeout);
                elements.loadingIndicator.classList.add('hidden');
            }

            // Initialize video player
            function initVideoPlayer(videoUrl) {
                elements.loadingIndicator.classList.remove('hidden');
                elements.errorMessage.style.display = 'none';
                retryCount = 0;

                loadingTimeout = setTimeout(() => {
                    if (!elements.loadingIndicator.classList.contains('hidden')) {
                        showError('Loading timeout. Please try another server.');
                    }
                }, 10000);

                if (hls) {
                    hls.destroy();
                    hls = null;
                }

                if (videoUrl.includes('.m3u8')) {
                    if (Hls.isSupported()) {
                        hls = new Hls({
                            maxBufferLength: 30,
                            maxMaxBufferLength: 60,
                            maxBufferSize: 60 * 1000 * 1000,
                            autoStartLoad: true
                        });
                        hls.loadSource(videoUrl);
                        hls.attachMedia(elements.videoPlayer);

                        hls.on(Hls.Events.MANIFEST_PARSED, () => {
                            elements.statusText.textContent = `HLS stream loaded (${hls.levels.length} quality levels)`;
                            showControlsTemporarily();
                            elements.videoPlayer.play().catch(e => showError('Playback failed: ' + e.message));
                        });

                        hls.on(Hls.Events.ERROR, (event, data) => {
                            if (data.fatal) {
                                switch (data.type) {
                                    case Hls.ErrorTypes.NETWORK_ERROR:
                                        if (retryCount < maxRetries) {
                                            retryCount++;
                                            setTimeout(() => hls.loadSource(videoUrl), 1000 * retryCount);
                                        } else {
                                            showError('Network error: Unable to load stream');
                                        }
                                        break;
                                    case Hls.ErrorTypes.MEDIA_ERROR:
                                        hls.recoverMediaError();
                                        break;
                                    default:
                                        showError('Fatal error: ' + data.details);
                                        break;
                                }
                            } else {
                                showError('Warning: ' + data.details);
                            }
                        });
                    } else if (elements.videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                        elements.videoPlayer.src = videoUrl;
                        elements.videoPlayer.addEventListener('canplay', () => {
                            hideLoading();
                            elements.statusText.textContent = 'HLS stream loaded (native)';
                            showControlsTemporarily();
                            elements.videoPlayer.play().catch(e => showError('Playback failed: ' + e.message));
                        }, { once: true });
                    } else {
                        showError('HLS is not supported in this browser');
                        hideLoading();
                    }
                } else {
                    elements.videoPlayer.src = videoUrl;
                    elements.videoPlayer.addEventListener('canplay', () => {
                        hideLoading();
                        elements.statusText.textContent = `Video loaded: ${elements.videoPlayer.videoWidth}x${elements.videoPlayer.videoHeight}`;
                        showControlsTemporarily();
                        elements.videoPlayer.play().catch(e => showError('Playback failed: ' + e.message));
                    }, { once: true });
                }

                elements.videoPlayer.addEventListener('error', () => {
                    showError('Error loading video. Please try another server.');
                    hideLoading();
                }, { once: true });

                elements.videoPlayer.addEventListener('canplay', hideLoading, { once: true });
            }

            // Format time
            function formatTime(seconds) {
                if (!isFinite(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            // Update progress
            function updateProgress() {
                if (elements.videoPlayer.duration) {
                    const percent = (elements.videoPlayer.currentTime / elements.videoPlayer.duration) * 100;
                    elements.progressBar.style.width = `${percent}%`;
                    elements.currentTimeDisplay.textContent = formatTime(elements.videoPlayer.currentTime);
                }
            }

            // Update icons
            function updateIcons() {
                elements.playPauseBtn.querySelector('i').className = elements.videoPlayer.paused ? 'fas fa-play' : 'fas fa-pause';
                elements.muteUnmuteBtn.querySelector('i').className = elements.videoPlayer.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
                elements.fullscreenBtn.querySelector('i').className = isFullscreen ? 'fas fa-compress' : 'fas fa-expand';
            }

            // Show controls temporarily
            function showControlsTemporarily() {
                elements.controlsOverlay.classList.remove('hidden');
                elements.statusBar.classList.remove('hidden');
                clearTimeout(controlsTimeout);
                controlsTimeout = setTimeout(() => {
                    if (!elements.videoPlayer.paused && !elements.serverDropdown.classList.contains('show')) {
                        elements.controlsOverlay.classList.add('hidden');
                        elements.statusBar.classList.add('hidden');
                    }
                }, 3000);
            }

            // Check if fullscreen is supported
            function isFullscreenSupported() {
                const isMobile = /iPhone|iPad|Android/i.test(navigator.userAgent);
                const element = isMobile ? elements.videoPlayer : elements.videoContainer;

                // Check for iframe restrictions
                if (window.self !== window.top) {
                    try {
                        const iframe = window.frameElement;
                        if (iframe && !iframe.hasAttribute('allowfullscreen') && !iframe.hasAttribute('webkitallowfullscreen')) {
                            return { supported: false, message: 'Fullscreen blocked: iframe missing allowfullscreen attribute.' };
                        }
                    } catch (e) {
                        return { supported: false, message: 'Fullscreen blocked: Unable to access iframe properties.' };
                    }
                }

                // Check browser support
                if (isMobile && elements.videoPlayer.webkitEnterFullscreen) {
                    return { supported: true };
                } else if (
                    element.requestFullscreen ||
                    element.mozRequestFullScreen ||
                    element.webkitRequestFullscreen ||
                    element.msRequestFullscreen
                ) {
                    return { supported: true };
                }

                return { supported: false, message: 'Fullscreen is not supported in this browser.' };
            }

            // Initialize fullscreen button state
            function initializeFullscreenButton() {
                const support = isFullscreenSupported();
                if (!support.supported) {
                    elements.fullscreenBtn.disabled = true;
                    elements.fullscreenBtn.title = support.message || 'Fullscreen not available';
                    showError(support.message || 'Fullscreen not supported on this device.');
                }
            }

            // Fullscreen handling
            async function enterFullscreen() {
                const isMobile = /iPhone|iPad|Android/i.test(navigator.userAgent);
                const element = elements.videoPlayer; // Always use videoPlayer for mobile

                try {
                    if (isMobile && elements.videoPlayer.webkitEnterFullscreen) {
                        elements.videoPlayer.webkitEnterFullscreen();
                    } else if (element.requestFullscreen) {
                        await element.requestFullscreen();
                    } else if (element.mozRequestFullScreen) {
                        element.mozRequestFullScreen();
                    } else if (element.webkitRequestFullscreen) {
                        element.webkitRequestFullscreen();
                    } else if (element.msRequestFullscreen) {
                        element.msRequestFullscreen();
                    } else {
                        showError('Fullscreen is not supported in this browser.');
                    }
                } catch (err) {
                    showError('Fullscreen request failed: ' + err.message);
                    if (err.message.includes('permissions policy')) {
                        showError('Fullscreen blocked by permissions policy. If in an iframe, ensure allowfullscreen is set.');
                    }
                }
            }

            async function exitFullscreen() {
                try {
                    if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
                        if (document.exitFullscreen) {
                            await document.exitFullscreen();
                        } else if (document.mozCancelFullScreen) {
                            document.mozCancelFullScreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        }
                    } else if (elements.videoPlayer.webkitDisplayingFullscreen) {
                        elements.videoPlayer.webkitExitFullscreen();
                    }
                } catch (err) {
                    showError('Exit fullscreen failed: ' + err.message);
                }
            }

            // Update fullscreen state
            function updateFullscreenState() {
                isFullscreen = !!document.fullscreenElement ||
                              !!document.webkitFullscreenElement ||
                              !!document.mozFullScreenElement ||
                              !!document.msFullscreenElement ||
                              elements.videoPlayer.webkitDisplayingFullscreen;
                updateIcons();
            }

            // Notification handling
            function showWelcomeNotification() {
                elements.welcomeNotification.style.display = 'flex';
                setTimeout(() => {
                    elements.welcomeNotification.style.display = 'none';
                }, 5000);
            }

            // Event listeners
            elements.playPauseBtn.addEventListener('click', () => {
                if (elements.videoPlayer.paused) elements.videoPlayer.play().catch(e => showError('Playback failed: ' + e.message));
                else elements.videoPlayer.pause();
                updateIcons();
                showControlsTemporarily();
            });

            elements.muteUnmuteBtn.addEventListener('click', () => {
                elements.videoPlayer.muted = !elements.videoPlayer.muted;
                elements.volumeSlider.value = elements.videoPlayer.muted ? 0 : elements.videoPlayer.volume;
                updateIcons();
                showControlsTemporarily();
            });

            elements.skipBackBtn.addEventListener('click', () => {
                elements.videoPlayer.currentTime = Math.max(0, elements.videoPlayer.currentTime - 10);
                showControlsTemporarily();
            });

            elements.skipForwardBtn.addEventListener('click', () => {
                elements.videoPlayer.currentTime = Math.min(elements.videoPlayer.duration, elements.videoPlayer.currentTime + 10);
                showControlsTemporarily();
            });

            elements.fullscreenBtn.addEventListener('click', async () => {
                if (!isFullscreen) {
                    await enterFullscreen();
                } else {
                    await exitFullscreen();
                }
                showControlsTemporarily();
            });

            elements.volumeSlider.addEventListener('input', () => {
                elements.videoPlayer.volume = elements.volumeSlider.value;
                elements.videoPlayer.muted = elements.volumeSlider.value === '0';
                updateIcons();
                showControlsTemporarily();
            });

            elements.serverButton.addEventListener('click', () => {
                elements.serverDropdown.classList.toggle('show');
                showControlsTemporarily();
            });

            elements.serverOptions.forEach(option => {
                option.addEventListener('click', () => {
                    retryCount = 0;
                    initVideoPlayer(option.getAttribute('data-url'));
                    elements.serverDropdown.classList.remove('show');
                    showControlsTemporarily();
                });
            });

            document.addEventListener('click', e => {
                if (!elements.serverButton.contains(e.target) && !elements.serverDropdown.contains(e.target)) {
                    elements.serverDropdown.classList.remove('show');
                }
            });

            elements.progressContainer.addEventListener('click', e => {
                const rect = elements.progressContainer.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                elements.videoPlayer.currentTime = percent * elements.videoPlayer.duration;
                showControlsTemporarily();
            });

            elements.videoPlayer.addEventListener('click', () => {
                if (elements.controlsOverlay.classList.contains('hidden')) {
                    showControlsTemporarily();
                } else {
                    elements.controlsOverlay.classList.add('hidden');
                    elements.statusBar.classList.add('hidden');
                    elements.serverDropdown.classList.remove('show');
                }
            });

            elements.videoPlayer.addEventListener('play', updateIcons);
            elements.videoPlayer.addEventListener('pause', updateIcons);
            elements.videoPlayer.addEventListener('timeupdate', updateProgress);
            elements.videoPlayer.addEventListener('loadedmetadata', () => {
                elements.durationDisplay.textContent = formatTime(elements.videoPlayer.duration);
            });

            // Fullscreen event listeners
            document.addEventListener('fullscreenchange', updateFullscreenState);
            document.addEventListener('webkitfullscreenchange', updateFullscreenState);
            document.addEventListener('mozfullscreenchange', updateFullscreenState);
            document.addEventListener('MSFullscreenChange', updateFullscreenState);
            elements.videoPlayer.addEventListener('webkitbeginfullscreen', () => {
                isFullscreen = true;
                updateIcons();
            });
            elements.videoPlayer.addEventListener('webkitendfullscreen', () => {
                isFullscreen = false;
                updateIcons();
            });

            elements.closeNotification.addEventListener('click', () => {
                elements.welcomeNotification.style.display = 'none';
            });

            // Orientation handling
            function handleOrientation() {
                if (window.matchMedia("(max-width: 768px)").matches && window.innerWidth < window.innerHeight) {
                    elements.rotatePrompt.style.display = 'flex';
                    setTimeout(() => {
                        elements.rotatePrompt.style.display = 'none';
                    }, 5000);
                } else {
                    elements.rotatePrompt.style.display = 'none';
                }
            }

            window.addEventListener('orientationchange', handleOrientation);
            window.addEventListener('resize', handleOrientation);

            // Initialize
            initVideoPlayer(VIDEO_SERVERS[0].url);
            handleOrientation();
            simulateViewCount();
            showWelcomeNotification();
            initializeFullscreenButton();
        });
    </script>
</body>
</html>
